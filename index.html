<!DOCTYPE html>
<html>
    <head>
        <title>mehd</title>

        <link rel="icon" type="image/png" sizes="16x16" href="img/mehd.png">

        <script src="js/peg-0.10.0.js"></script>
        <script src="js/vcdisplay.js"></script>
        <script src="js/luaengine.js"></script>
        <script src="js/fontmgr.js"></script>
        <script src="js/undomgr.js"></script>
        <script src="js/scrollbar.js"></script>
        <script src="js/statusbar.js"></script>
        <script src="js/selection.js"></script>
        <script src="js/editor.js"></script>
        <script src="js/main.js"></script>
    </head>
    <body>

        <span id="versionSpan" style="user-select: none;float:left">mehd vx.x</span><span id="fpsspan"  style="user-select: none"> - </span>
        <canvas id="maincanvas" width="1100" height="650" style="float:left; clear:both"></canvas>

        <img id="fontImage" src="img/font5x7_2.png" style="display:none" />

        <img id="arrowUp" src="img/arrowUp.png" style="display:none" />
        <img id="arrowDown" src="img/arrowDown.png" style="display:none" />

        <div id="luaGrammar" style="display:none">
        
            start=(instr:instruction newLine)*

            instruction=[ \t]* comm:comment {return comm; } /
            [ \t]* assi:assignmentStatement {return assi;} /
            [ \t]* fori:forStatement {return fori;} /
            [ \t]* iffe:ifStatement {return iffe;} /
            [ \t]* fcall:functionCallStatement {return fcall;} /
            [ \t]* increment:incrementStatement {return increment;} /
            [ \t]* lab:labelStatement {return lab;} /
            [ \t]* gotoLab:gotoStatement {return gotoLab;} /
            [ \t]* emptyLine

            /* labels & "goto considered harmful" */

            labelStatement="::" lname:labelName "::" {return lname; }

            gotoStatement="goto" [ ] lname:labelName {return ['GOTO',lname] }

            /* increment statement */

            incrementStatement=vname:variableName "+=" rval:expression { return ['INCREMENT',vname,rval] }

            /* comment statement */

            comment="--" commentText:[ A-Za-z0-9\.\;\,\:\-\_\?\'\^\!\"\$\(\)\=\/]* { return ['COMMENT',commentText.join('')]; }

            /* assignment statement */

            assignmentStatement=vname:variableName "=" rval:expression { return ['ASSIGNMENT',vname,rval] }

            variableName = the1var:[a-zA-Z] the2var:[a-zA-Z0-9\$]* { return ['VARIABLE',the1var+the2var.join("")]; } 

            labelName = the1var:[a-zA-Z] the2var:[a-zA-Z0-9\$]* { return ['LABEL',the1var+the2var.join("")]; } 

            /* if statement */

            ifStatement="if" [ ]+ expression rop:relop expression [ ]+ "then" "\n" instruction* "end" { return ['IF',rop] }

            relop="<"/"<="/"=="/">="/">"

            expression=additive

            additiveOperator = "+" { return "+"; } / "-" { return "-"; }

            multiplicativeOperator = "*" { return "*"; } / "/" { return "/"; }

            modulusOperator = "\%"
            
            additive = head:multiplicative tail:(additiveOperator multiplicative)* 
            {      
                var result = head;      
                for (var i = 0; i < tail.length; i++) 
                {        
                    result = 
                    {          
                        operator: tail[i][0],          
                        left:     result,          
                        right:    tail[i][1]        
                    };      
                }      
                return result;    
            }

            multiplicative = head:modular tail:(multiplicativeOperator modular)* 
            {      
                var result = head;      
                for (var i = 0; i < tail.length; i++) 
                {        
                    result = 
                    {          
                        operator: tail[i][0],          
                        left:     result,          
                        right:    tail[i][1]        
                    };      
                }      
                return result;    
            }

            modular = head:primary tail:(modulusOperator primary)* 
            {      
                var result = head;      
                for (var i = 0; i < tail.length; i++) 
                {        
                    result = 
                    {          
                        operator: tail[i][0],          
                        left:     result,          
                        right:    tail[i][1]        
                    };      
                }      
                return result;    
            }

            primary=floatNumber/
            integerNumber/
            quotedString/
            functionCallStatement/
            variableName/
            "(" additive:additive ")"  { return additive; }

            /* for statement */

            forStatement="for" [ ]+ vname:variableName "=" fromi:integerNumber "," toi:integerNumber ","? stri:integerNumber? [ ]+ "do" "\n" 
                instrs:(instruction)* "end" 
                {
                    var dataArray=new Array();
                    for (var i = 0; i < instrs.length; i++)
                    {        
                        dataArray.push([instrs[i]]);
                    }
                    return ["FOR",vname,fromi,toi,dataArray,stri];
                }

            functionCallStatement=funname:functionName "(" alist:arglist? ")" { return ['FUNCTIONCALL',funname,alist] }

            functionName = the1var:[a-zA-Z] the2var:[a-zA-Z0-9\$]* { return the1var+the2var.join(""); } 

            arglist = head:argument tail:("," argument)*
            {
                var dataArray=new Array();
                dataArray.push(head);
                for (var i = 0; i < tail.length; i++) 
                {        
                    dataArray.push(tail[i][1]);
                }	
                return ["FUNARGLIST",dataArray];
            }            

            argument=expression

            integerNumber = sign:"-"? digits:[0-9]+
            {
                var val=parseInt(digits.join(""), 10); 
            
                if (sign=="-")
                {
                    return -val; 
                }
                
                return val;
            }

            floatNumber = sign:"-"? idigits:[0-9]+ "." fdigits:[0-9]+
            {
                var val=0;
                var ival=parseInt(idigits.join(""), 10);
                var fval=fdigits.join("");
                
                var concat=ival.toString()+"."+fval.toString();
                    
                val=parseFloat(concat); 
            
                if (sign=="-")
                {
                    return -val; 
                }
                
                return val;
            }            

            doubleQuotes="\""

            quotedString = doubleQuotes stringCorpus:[a-zA-Z0-9 ]* doubleQuotes { return stringCorpus.join(''); }

            emptyLine= "\n"

            newLine="\n"
            
        </div>

    </body>

</html>
